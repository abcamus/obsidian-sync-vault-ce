# 开发指导

## 阿里云盘

> 阿里云盘不支持文件覆盖，同一个目录下可以存在多个同名的文件。

阿里云盘所有文件的操作基于`file_id`，因此需要先获取`file_id`。获取`file_id`的接口有：

- `get_by_path`
- `create_file`
- `create_directory`

### 上传
阿里云盘目前不支持上传覆盖，因此如果上传已经存在的文件，需要先删除文件，再上传。
流程：
1. 获取`file_id`，如果文件不存在，则创建文件，否则到2，同时保存parent_file_id（防止频繁调用`get_by_path`）
2. 删除文件
3. 上传文件

### QPS及处理
来源：[阿里云盘API常见问题](https://www.yuque.com/aliyundrive/zpfszx/zscu11)

`get_by_path`、`list`、`getDownloadUrl`三个接口有QPS限制，超出后会返回429错误。

增加`throw: false`参数，防止抛出异常。增加delay，具体数值未找到。

# 安全合规
> 非常重要

1. client_secret 请注意安全保存，不要放在前端代码里，泄露后请刷新更换。
2. access_token 和 refresh_token 代表调接口的授权凭证，不要泄露给他人，滥用会触发风控。一旦发生泄漏，请引导用户在云盘APP里解除授权，再次授权后之前的Token会全部失效。
3. 以任何方式共享账号的行为都是严格禁止的，安全审核机器人会对这类账号进行封号处理，且无法解封。包括但是不限于：
  a. 让应用的使用者直接使用应用开发者的 token；
  b. 应用开发者使用自己的账号获取文件的预览/下载链接，并且通过应用分发给应用使用者。